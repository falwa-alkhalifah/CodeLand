<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Quiz Management - HTML101</title>
   <link rel="stylesheet" href="H-style.css">
   <link rel="stylesheet" href="HF.css">
</head>

<body>
    <!-- ====== HEADER ====== -->
    <header class="cl-header">
        <div class="brand">
            <img src="images/logo.png" alt="Logo">
            <span>Codeland</span>
        </div>

        <div class="actions">
            <a href="educator.html">
                <img src="images/educatorUser.jpeg" alt="User" class="avatar">
            </a>
            <a href="login.html" class="logout-btn">Logout</a>
        </div>
    </header>

    <main>
        <div class="container">
        <div id="toast" class="toast"></div>

        <!-- Page Header -->
        <section class="page-header">
            <h1 id="quiz-title">HTML101 Quiz Questions</h1>
            <a href="add-question.html" id="add-question-btn" class="btn">+ Add Question</a>
        </section>

        <!-- Questions Table -->
        <section class="table-section">
            <table class="table" id="questions-table">
                <thead>
                    <tr>
                        <th>Question</th>
                        <th class="actions-column">Edit</th>
                        <th class="actions-column">Delete</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="question-column">
                            <div class="question-text">Which HTML tag is used to create a hyperlink?</div>
                            <div class="choices-container">
                                <span class="choice correct">A- &lt;a&gt;</span>
                                <span class="choice">B- &lt;link&gt;</span>
                                <span class="choice">C- &lt;href&gt;</span>
                                <span class="choice">D- &lt;url&gt;</span>
                            </div>
                        </td>
                        <td class="actions-column">
                            <a href="edit-question.html" class="btn btn-edit action-button">Edit</a>
                        </td>
                        <td class="actions-column">
                            <a href="Quiz.html" class="btn btn-delete action-button">Delete</a>
                        </td>
                    </tr>
                    <tr>
                        <td class="question-column">
                            <div class="question-text">What would be the output for this code? (Lists question with image)</div>
                            <div class="choices-container">
                                <span class="choice">A- Option A</span>
                                <span class="choice correct">B- Option B</span>
                                <span class="choice">C- Option C</span>
                                <span class="choice">D- Option D</span>
                            </div>
                        </td>
                        <td class="actions-column">
                            <a href="edit-question.html" class="btn btn-edit action-button">Edit</a>
                        </td>
                        <td class="actions-column">
                            <a href="Quiz.html" class="btn btn-delete action-button">Delete</a>
                        </td>
                    </tr>
                    <tr>
                        <td class="question-column">
                            <div class="question-text">What does HTML stand for?</div>
                            <div class="choices-container">
                                <span class="choice">A- Hyperlinks and Text Markup Language</span>
                                <span class="choice">B- Home Tool Markup Language</span>
                                <span class="choice correct">C- Hyper Text Markup Language</span>
                                <span class="choice">D- Hyper Tool Markup Language</span>
                            </div>
                        </td>
                        <td class="actions-column">
                            <a href="edit-question.html" class="btn btn-edit action-button">Edit</a>
                        </td>
                        <td class="actions-column">
                            <a href="Quiz.html" class="btn btn-delete action-button">Delete</a>
                        </td>
                    </tr>
                    <tr>
                        <td class="question-column">
                            <div class="question-text">Which tag is used to display the largest heading?</div>
                            <div class="choices-container">
                                <span class="choice">A- &lt;h6&gt;</span>
                                <span class="choice correct">B- &lt;h1&gt;</span>
                                <span class="choice">C- &lt;title&gt;</span>
                                <span class="choice">D- &lt;head&gt;</span>
                            </div>
                        </td>
                        <td class="actions-column">
                            <a href="edit-question.html" class="btn btn-edit action-button">Edit</a>
                        </td>
                        <td class="actions-column">
                            <a href="Quiz.html" class="btn btn-delete action-button" >Delete</a>
                        </td>
                    </tr>
                    <tr>
                        <td class="question-column">
                            <div class="question-text">The &lt;br&gt; tag is used to insert a line break.</div>
                            <div class="choices-container">
                                <span class="choice correct">A- True</span>
                                <span class="choice">B- False</span>
                            </div>
                        </td>
                        <td class="actions-column">
                            <a href="edit-question.html" class="btn btn-edit action-button">Edit</a>
                        </td>
                        <td class="actions-column">
                            <a href="Quiz.html" class="btn btn-delete action-button">Delete</a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>
        </div> 
    </main>
      
    <!-- ====== FOOTER ====== -->
    <footer class="cl-footer">
        <p>OUR VISION</p>
        <p>At CodeLand, we make coding education simple, engaging, and accessible for everyone</p>
        <p>© <span id="year"></span>2025 Website. All rights reserved.</p>
        <div class="social">
            <a href="#"><img src="images/xpng.jpg" alt="Twitter"></a>
            <a href="#"><img src="images/facebook.png" alt="Facebook"></a>
            <a href="#"><img src="images/instagram.png" alt="Instagram"></a>
        </div>
    </footer>
<script>
document.addEventListener('DOMContentLoaded', function () {
  // التقط ضغطات Edit وخزّن بيانات السؤال + رابط الرجوع + فهرس الصف + النص الأصلي
  document.querySelectorAll('.btn-edit.action-button').forEach(function(btn){
    btn.addEventListener('click', function(e){
      e.preventDefault();

      const tr = btn.closest('tr');
      if (!tr) return;

      const rowIndex = Array.from(tr.parentElement.querySelectorAll('tr')).indexOf(tr);
      const qTextEl = tr.querySelector('.question-text');
      const originalText = (qTextEl?.textContent || '').trim();

      const choiceEls = tr.querySelectorAll('.choices-container .choice');
      const choices = Array.from(choiceEls).map(el =>
        (el.textContent || '').replace(/^[A-D]\s*-\s*/i, '').trim()
      );
      let correctIndex = Array.from(choiceEls).findIndex(el => el.classList.contains('correct'));
      if (correctIndex < 0) correctIndex = 0;

      localStorage.setItem('currentQuestion', JSON.stringify({
        text: originalText, choices, correctIndex, originalText
      }));
      localStorage.setItem('currentQuestionRowIndex', String(rowIndex));
      localStorage.setItem('currentQuestionReturnUrl', location.href);

      location.href = btn.getAttribute('href') || 'edit-question.html';
    });
  });

  // عند الرجوع من صفحة التعديل طبّق التحديث على نفس الصف
  (function applyUpdatedIfAny(){
    if (!localStorage.getItem('currentQuestionUpdated')) return;

    const payload = JSON.parse(localStorage.getItem('currentQuestion') || 'null');
    const rowIndex = Number(localStorage.getItem('currentQuestionRowIndex'));
    const rows = document.querySelectorAll('#questions-table tbody tr');

    // ابحث أولاً بالنص الأصلي (أدق)، لو ما لقيته استخدم فهرس الصف
    let targetRow = null;
    if (payload?.originalText) {
      for (const r of rows) {
        const t = r.querySelector('.question-text')?.textContent?.trim() || '';
        if (t === payload.originalText) { targetRow = r; break; }
      }
    }
    if (!targetRow && rows[rowIndex]) targetRow = rows[rowIndex];

    if (payload && targetRow) {
      // عدّل نص السؤال
      const textEl = targetRow.querySelector('.question-text');
      if (textEl) textEl.textContent = payload.text || '';

      // عدّل الخيارات والجواب الصحيح
      const choiceEls = targetRow.querySelectorAll('.choices-container .choice');
      choiceEls.forEach((el, i) => {
        const label = String.fromCharCode(65 + i); // A,B,C,D
        const text = payload.choices?.[i] ?? '';
        el.textContent = `${label}- ${text}`;
        el.classList.toggle('correct', i === payload.correctIndex);
      });
    }

    // نظّف العلامات المؤقتة
    localStorage.removeItem('currentQuestionUpdated');
    localStorage.removeItem('currentQuestion');
    localStorage.removeItem('currentQuestionRowIndex');
    // اتركي currentQuestionReturnUrl مفيد لزر Cancel
  })();
});
</script>

    
</body>
</html>
